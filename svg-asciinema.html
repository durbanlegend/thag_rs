<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SVG Asciinema Player</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    background: #f5f5f5;
  }
  #controls {
    display: flex;
    gap: 10px;
    margin: 10px 0;
  }
  button {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    background: #ddd;
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  #viewer {
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.15);
    overflow: hidden;
    max-width: 90vw;
  }
  #viewer svg {
    width: 100%;
    height: auto;
  }
  #timeline {
    margin-top: 15px;
    width: 100%;
  }
  #log {
    margin-top: 10px;
    width: 90%;
    max-width: 800px;
    height: 200px;
  }
</style>
</head>
<body>

<div id="controls">
  <button id="record">Record</button>
  <button id="stop" disabled>Stop</button>
  <button id="play" disabled>Play</button>
</div>

<div id="viewer">
  <!-- Inline the SVG or embed it -->
  <object id="svgobj" data="flamegraph.svg" type="image/svg+xml" width="1200" height="174"></object>
</div>

<textarea id="log" placeholder="Recorded events (JSON)" readonly></textarea>

<script>
let recording = false;
let events = [];
let svgDoc = null;

const recordBtn = document.getElementById('record');
const stopBtn = document.getElementById('stop');
const playBtn = document.getElementById('play');
const log = document.getElementById('log');
const svgObj = document.getElementById('svgobj');

svgObj.addEventListener('load', () => {
  svgDoc = svgObj.contentDocument;
});

recordBtn.onclick = () => {
  if (!svgDoc) return alert('SVG not loaded yet.');
  events = [];
  recording = true;
  recordBtn.disabled = true;
  stopBtn.disabled = false;
  playBtn.disabled = true;

  svgDoc.addEventListener('click', onClick);
  svgDoc.addEventListener('mouseover', onHover);
};

stopBtn.onclick = () => {
  recording = false;
  recordBtn.disabled = false;
  stopBtn.disabled = true;
  playBtn.disabled = events.length === 0;
  svgDoc.removeEventListener('click', onClick);
  svgDoc.removeEventListener('mouseover', onHover);
  log.value = JSON.stringify(events, null, 2);
};

playBtn.onclick = () => {
  if (!svgDoc) return;
  let i = 0;
  function playNext() {
    if (i >= events.length) return;
    const ev = events[i++];
    const el = svgDoc.querySelector(`[data-id="${ev.target}"]`) || svgDoc.getElementById(ev.target);
    if (el) {
      el.style.transition = 'fill 0.2s';
      el.style.fill = ev.type === 'click' ? '#ff6666' : '#ffcc00';
      setTimeout(() => {
        el.style.fill = '';
        playNext();
      }, 400);
    } else {
      playNext();
    }
  }
  playNext();
};

function onClick(e) {
  if (!recording) return;
  const id = e.target.id || e.target.getAttribute('data-id');
  events.push({ type: 'click', target: id, time: Date.now() });
}

function onHover(e) {
  if (!recording) return;
  const id = e.target.id || e.target.getAttribute('data-id');
  events.push({ type: 'hover', target: id, time: Date.now() });
}
</script>

</body>
</html>
